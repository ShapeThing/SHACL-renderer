@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix schema: <https://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dash: <http://datashapes.org/dash#> .
@prefix stsr: <http://ontology.shapething.com/shacl-renderer#> .
@prefix stf: <http://ontology.shapething.com/facet#> .
@prefix dbc: <http://dbpedia.org/resource/Category:> .
@prefix wdt: <http://www.wikidata.org/prop/direct/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix faker: <https://fakerjs.dev/> .

<>
  a sh:NodeShape ;
  sh:targetClass sh:NodeShape ;
  sh:closed true ;

  sh:property [
    sh:name "Name"@en, "Naam"@nl ;
    sh:minCount 1;
		sh:uniqueLang true ;
    sh:group <#name> ;
    sh:path sh:name ;
    sh:datatype rdf:langString ;
  ];

  sh:property [
    sh:name "Target"@en, "Doel"@nl ;
    sh:minCount 1;
    sh:maxCount 1;
    sh:group <#name> ;
    sh:path sh:targetClass ;
    sh:nodeKind sh:IRI ;
    dash:editor dash:URIEditor ;
  ];

  sh:property [
    sh:name "Closed"@en, "Gesloten"@nl ;
    sh:maxCount 1;
    sh:datatype xsd:boolean ;
    sh:group <#booleans>;
    sh:path sh:closed ;
  ];

  sh:property [
    sh:name "Abstract"@en, "Abstract"@nl ;
    sh:maxCount 1;
    sh:datatype xsd:boolean ;
    sh:group <#booleans>;
    sh:path dash:abstract ;
  ];

  # sh:property [
  #   sh:name "Ignored properties"@en, "Genegeerde eigenschappen"@nl ;
  #   sh:group <#booleans>;
  #   sh:path sh:ignoredProperties ;
  # ];

  sh:property [
    sh:name "Stem"@en, "Stam"@nl ;
    sh:minCount 1;
    sh:maxCount 1;
    sh:group <#stem-icon> ;
    sh:path dash:stem ;
    dash:editor dash:URIEditor ;
  ];

  sh:property [
    sh:name "Icon"@en, "Icoon"@nl ;
    sh:minCount 1;
    sh:maxCount 1;
    sh:group <#stem-icon> ;
    sh:path stsr:icon ;
    sh:datatype <https://iconify.design> ;
  ];

  sh:property [
    sh:name "Properties"@en, "Eigenschappen"@nl ;
    sh:minCount 1;
    sh:path sh:property ;
    sh:nodeKind sh:BlankNode ;
    sh:node <#propertyShape>;
  ];

  sh:property [
    sh:name "Name pattern"@en, "Naam patroon"@nl ;
    sh:minCount 1;
    sh:path ( stsr:filenameSuggestion [ sh:zeroOrMorePath rdf:rest ] rdf:first ) ;
    sh:in [
      sh:select """
        prefix sh: <http://www.w3.org/ns/shacl#>

        SELECT distinct ?value ?label
        WHERE {
          ?property ^sh:property ?node .
          ?property sh:path ?value .
          ?property sh:name ?label .
        }
        """ ;
    ] ;
  ];

.

<#booleans>
	a sh:PropertyGroup ;
	sh:order 3 .

<#stem-icon>
	a sh:PropertyGroup ;
	sh:order 2 .

<#name>
	a sh:PropertyGroup ;
	sh:order 1 .

<#propertyName>
	a sh:PropertyGroup ;
  sh:group <#propertyShapeGroup> ;
	sh:order 1 .

<#cardinality>
	a sh:PropertyGroup ;
  sh:group <#propertyShapeGroup> ;
	sh:order 4 .

<#misc>
	a sh:PropertyGroup ;
  sh:group <#propertyShapeGroup> ;
	sh:order 4 .

<#details>
	a sh:PropertyGroup ;
  sh:group <#propertyShapeGroup> ;
	sh:order 3 .

<#propertyShapeGroup>
	a sh:PropertyGroup, stsr:CollapsiblePropertyGroup;
  stsr:groupLabelPath ( "Eigenschap: "@nl "Property: "@en sh:name ) ;
	sh:order 1 .

<#propertyShape>
  sh:closed true ;
  a sh:NodeShape ;
  dash:abstract true ;

  sh:ignoredProperties ( faker:generator sh:in ) ;

  sh:property [
    sh:name "Name"@en, "Name"@nl ;
    sh:minCount 1;
		sh:uniqueLang true ;
    sh:group <#propertyName> ;
    sh:path sh:name ;
    sh:datatype rdf:langString ;
  ];

  sh:property [
    sh:name "Ignored properties"@en, "Genegeerde eigenschappen"@nl ;
    sh:path sh:ignoredProperties ;
    sh:group <#misc> ;
  ];

  sh:property [
    sh:name "Order"@en, "Volgorde"@nl ;
    sh:maxCount 1;
    sh:group <#misc> ;
    sh:datatype xsd:float ;
    sh:path sh:order ;
  ];

  sh:property [
    sh:name "Closed"@en, "Gesloten"@nl ;
    sh:maxCount 1;
    sh:group <#misc> ;
    sh:datatype xsd:boolean ;
    sh:path sh:closed ;
  ];

  sh:property [
    sh:name "Description"@en, "Omschrijving"@nl ;
    dash:singleLine false ;
    sh:order 5;
		sh:uniqueLang true ;
    sh:group <#propertyShapeGroup> ;
    sh:path sh:description ;
    sh:datatype rdf:langString ;
  ];

  sh:property [
    sh:name "Path"@en, "Pad"@nl ;
    sh:minCount 1;
    sh:group <#propertyName> ;
    sh:maxCount 1;
    dash:editor dash:URIEditor ;
    sh:path sh:path ;
    sh:nodeKind sh:IRI ;
  ];
  
  sh:property [
    sh:name "Minimum count"@en, "Minimaal aantal"@nl ;
    sh:group <#cardinality> ;
    sh:maxCount 1;
    sh:path sh:minCount ;
    sh:datatype xsd:integer ;
  ];
    
  sh:property [
    sh:name "Maximum count"@en, "Maximaal aantal"@nl ;
    sh:maxCount 1;
    sh:group <#cardinality> ;
    sh:path sh:maxCount ;
    sh:datatype xsd:integer ;
  ];

  sh:property [
    sh:name "Group"@en, "Groep"@nl ;
    sh:group <#details> ;
    sh:maxCount 1;
    sh:path sh:group ;
    sh:in [
      sh:select """
        prefix sh: <http://www.w3.org/ns/shacl#>

        SELECT distinct ?value ?label
        WHERE {
          ?value a sh:PropertyGroup .
          optional {
            ?value sh:name ?name .
          }
          bind(coalesce(?name, strafter(str(?value), "#"), strafter(str(?value), "/")) as ?label)
        }
        """ ;
    ] ;
  ];

  sh:property [
    sh:name "Data type"@en, "Data type"@nl ;
    sh:group <#details> ;
    sh:maxCount 1;
    sh:path sh:datatype ;
    sh:in (
      xsd:string xsd:float rdf:langString
    ) ;
  ];
.

xsd:string rdfs:label "Text" .
xsd:integer rdfs:label "Integer" .
xsd:float rdfs:label "Float" .
rdf:langString rdfs:label "Multilingual text" .